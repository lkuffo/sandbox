<!DOCTYPE html>
<html>
  <%- include('header.ejs') %>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li><a href="http://138.201.30.170/fundamentos/web/index">Inicio <span class="sr-only">(current)</span></a></li>
            <li><a href="http://138.201.30.170/fundamentos/web/curso">Curso</a></li>
            <li><a href="http://138.201.30.170/fundamentos/web/semanas">Planificación</a></li>
            <li><a href="http://138.201.30.170/fundamentos/web/equipo">Equipo</a></li>
            <li><a href="http://138.201.30.170/fundamentos/web/ayudantias">Ayudantías</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Marcos Calderón <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="http://138.201.30.170/fundamentos/web/perfilProfesor">Perfil</a></li>
                <li><a href="http://138.201.30.170/fundamentos/web/practicarProfesor">Ejercicios</a></li>
                <li><a href="http://138.201.30.170/fundamentos/web/proyectos">Proyectos</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="http://138.201.30.170/fundamentos/web/index">Cerrar sesión</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Made Velasco <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="http://138.201.30.170/fundamentos/web/perfilEstudiante">Perfil</a></li>
                <li><a href="http://138.201.30.170/fundamentos/web/practicar">Ejercicios</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="http://138.201.30.170/fundamentos/web/index">Cerrar sesión</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Inicia sesión<span class="caret"></span></a>
              <ul id="login-dp" class="dropdown-menu">
                <li>
                  <div class="row">
                    <div class="col-md-12">
                      <form class="form" role="form" method="post" action="login" accept-charset="UTF-8" id="login-nav">
                        <div class="form-group">
                          <label class="sr-only" for="loginEmail">Dirección de correo</label>
                          <input type="email" class="form-control" id="loginEmail" placeholder="Correo ESPOL" required="">
                        </div>
                        <div class="form-group">
                          <label class="sr-only" for="loginPassword">Contraseña</label>
                          <input type="password" class="form-control" id="loginPassword" placeholder="Contraseña" required="">
                          <div class="help-block text-right"><a href="http://www.serviciosti.espol.edu.ec/ui/es/content/cta_elec/restablecer.aspx">¿Olvidaste la contraseña?</a></div>
                        </div>
                        <div class="form-group">
                          <button class="btn btn-primary btn-block" id="menulogin">Entrar</button>
                        </div>
                        <div class="checkbox">
                          <label>
                            <input type="checkbox"> Mantenme conectado
                          </label>
                        </div>
                      </form>
                    </div>
                  </div>
                </li>
              </ul>
            </li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>

    <br>
    <h2> Módulo de Ejercicios </h2> 
    <br>
    <div class="container">

      <button type="button" class="btn btn-default" id="agregarEjercio" data-toggle="modal" data-target="#modalAgregarEjercicio">
        <span class="glyphicon glyphicon-plus"></span> Agregar Ejercicio
      </button>
      
      <br>
      <br>

      <table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Titulo</th>
                <th>Descripcion</th>
                <th>Datos de Entrada</th>
                <th>Datos de Salida</th>
                <th>Etiquetas</th>
                <th>Nivel</th>
                <th>Editar</th>
                <th>Eliminar</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th>Titulo</th>
                <th>Descripcion</th>
                <th>Datos de Entrada</th>
                <th>Datos de Salida</th>
                <th>Etiquetas</th>
                <th>Nivel</th>
                <th>Editar</th>
                <th>Eliminar</th>
            </tr>
        </tfoot>
        <tbody id="tablaDeEjercicios">

        </tbody>
    </table>
    </div>

    <div class="modal fade" id="modalAgregarEjercicio">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Agregar Ejercicio</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">

            <form method="POST" action="/ejercicios/new/ejercicio">

              <div class="form-group">
                <label for="project-title">Título</label>
                <input class="form-control validarTitulox" type="text" name="tituloNewEjer" placeholder="Ingresa un título" id="project-title">
              </div>
              <div class="form-group">
                <label for="project-description">Descripción</label>
                <textarea class="form-control validarDescx"  name="descNewEjer" rows="2" placeholder="Describe brevemente de qué consiste el ejercicio"></textarea>
              </div>
              <div class="form-group">
                <label for="project-description">Datos de Entrada</label>
                <textarea class="form-control validarEntrada" name="dataEnNewEjer" rows="2"></textarea>
              </div>
              <div class="form-group">
                <label for="project-description">Datos de Salida</label>
                <textarea class="form-control validarSalida" name="dataSaNewEjer"  rows="2"></textarea>
              </div>
              
             <div class = 'form-group'>
                <label for="project-tags">Tags:</label>
                <input class="form-control validarTagx" type="tags" placeholder="Añade algunos tags..." name="tagsNewEjer"  data-role="tagsinput" id="project-tags"/>
              </div>

              <div class="form-group">
                <div class = 'row pt-15'>
                  <div class = 'col-md-3 col-xs-6'>
                    <label for="project-description">Dificultad</label>
                    <select class="form-control"  name="nivelNewEjer">
                      <option>Fácil</option>
                      <option>Medio</option>
                      <option>Difícil</option>
                    </select>
                  </div>
                </div>
              </div>    
        
              <button type="submit" class="btn btn-primary">Guardar</button>
            </form>


          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalEditarEjercicio">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Editar Ejercicio</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">

            <form method="PUT" id="form-editarEjercicio"" action="/ejercicios/edit/">
              <div class="form-group">
                <label for="project-title">Título</label>
                <input class="form-control validarTituloy" type="text" name="tituloNewEjer" placeholder="Ingresa un título" id="project-title">
              </div>
              <div class="form-group">
                <label for="project-description">Descripción</label>
                <textarea class="form-control validarDescy" id="project-description" name="descNewEjer" rows="2" placeholder="Describe brevemente de qué consiste el ejercicio"></textarea>
              </div>
              <div class="form-group">
                <label for="project-description">Datos de Entrada</label>
                <textarea class="form-control validarEntraday" name="dataEnNewEjer" id="project-description" rows="2"></textarea>
              </div>
              <div class="form-group">
                <label for="project-description">Datos de Salida</label>
                <textarea class="form-control validarSaliday" name="dataSaNewEjer" id="project-description" rows="2"></textarea>
              </div>
              
             <div class = 'form-group'>
                <label for="project-tags">Tags:</label>
                <input class="form-control validarTagy" type="tags" placeholder="Añade algunos tags..." name="tagsNewEjer"  data-role="tagsinput" id="project-tags"/>
              </div>

              <div class="form-group">
                <div class = 'row pt-15'>
                  <div class = 'col-md-3 col-xs-6'>
                    <label for="project-description">Dificultad</label>
                    <select class="form-control" id="selectValidary" name="nivelNewEjer">
                      <option>Fácil</option>
                      <option>Medio</option>
                      <option>Difícil</option>
                    </select>
                  </div>
                </div>
              </div>    

              <button type="submit" class="btn btn-primary">Guardar</button>
            </form>


          </div>
        </div>
      </div>

    <%- include('footer.ejs') %>
    
   <script type="text/javascript" charset="utf-8">

        $(document).ready(function() {

          $("#tablaDeEjercicios").empty();
            $.get("/ejercicios/all", function(usuarios){
                //console.log(usuarios);
                for (var i = 0; i < usuarios.length; i++){
                    var registro = usuarios[i];
                    //console.log(registro._id);
                    $("#tablaDeEjercicios").append("<tr><td>"+registro.titulo+"</td><td>"+registro.descripcion+"</td><td>"+registro.datosEntrada+"</td><td>"+registro.datosSalida+"</td><td>"+registro.etiquetas+"</td><td>"+registro.nivelDificultad+"</td>"+ "<td><button type='button' class='btn btn-default editar-ejercicio' id='"+registro._id+"'><span class='glyphicon glyphicon-pencil' aria-hidden='true'></span></button></td> <td><button type='button' class='btn btn-default eliminar-ejercicio' id='"+registro._id+"'><span class='glyphicon glyphicon-remove' aria-hidden='true'></span></button></td>"+"</tr>")
                }

                $(".editar-ejercicio").click(function(){
                  var idEjer = this.id;
                 //identif_actual = $($(this).parent().siblings()[0]).text();
                  $("#form-editarEjercicio").attr("action", "/ejercicios/edit/"+idEjer);
                  titulo_edit = $($(this).parent().siblings()[0]).text();
                  descrip_edit = $($(this).parent().siblings()[1]).text();
                  datosEn_edit = $($(this).parent().siblings()[2]).text();
                  datosSa_edit = $($(this).parent().siblings()[3]).text();
                  etiquetas_edit = $($(this).parent().siblings()[4]).text();
                  nivelDificultad_edit = $($(this).parent().siblings()[5]).text();
              

                  $(".validarTituloy").val(titulo_edit);
                  $(".validarDescy").val(descrip_edit);
                  $(".validarEntraday").val(datosEn_edit);
                  $(".validarSaliday").val(datosSa_edit);
                  $(".validarTagy").val(etiquetas_edit);
                  $("#selectValidary").val(nivelDificultad_edit);
                  $("#modalEditarEjercicio").modal('show');
                });

                $(".eliminar-ejercicio").click(function(){
                  var idEjerDel = this.id;
                  var url = "/ejercicios/"+idEjerDel;
                  
                  $.ajax({
                    url: url,
                    type: 'DELETE',
                    success: function(result){
                      
                    }
                  })
                  location.reload();
                });

                $('#example').DataTable();
            });
        });

        $("#agregarEjercicio").click(function(){

          // $(".validarTitulox").val("");
          // $(".validarDescx").val("");
          // $(".validarEntrada").val(datosEn_edit);
          // $(".validarSalida").val(datosSa_edit);
          // $(".validarTagx").val(etiquetas_edit);
          // $("#selectValidar").text(nivelDificultad_edit);
          $("#modalAgregarEjercicio").modal('show');
        });
             
    </script>
 

  </body>
</html>
